# PyQCM installation

## Defaut installation using pip

This is the easiest installation of PyQCM suitable for all user.
It build the PyQCM library and download dependencies automatically using default system compiler and library.

1. Open a terminal and clone PyQCM Git repository:

```
git clone https://bitbucket.org/dsenechQCM/qcm_wed.git
cd qcm_wed #enter cloned repository
```

2. Perform automatic installation with `pip`:

```
pip install .
```

## Installation from source

These instructions allow a finely tunned compilation of the qcm library and dependencies for better performance.
Library and dependencies compilation and installation are no more handled automatically.

1. Clone PyQCM and download CUBA source:

```
git clone https://bitbucket.org/dsenechQCM/qcm_wed.git
wget http://www.feynarts.de/cuba/Cuba-4.2.1.tar.gz
tar -xf Cuba-4.2.1.tar.gz
```

2. Configure and compile CUBA:

```
cd Cuba-4.2.1 #enter extraction CUBA directory
./configure CFLAGS="-O3 -fPIC -ffast-math -fomit-frame-pointer"
make lib
cd .. #return common directory
```

3. Configure and compile QCM library:

```
cd qcm_wed #enter extraction CUBA directory
mkdir build && cd build
cmake .. -DCMAKE_BUILD_TYPE=Release -DCUBA_DIR=../CUBA-4.2.1
make
make install
```

4. Run `setup.py` script to install the python library:

```
cd .. #exit build and go in source qcm dirs
python setup.py --skip-cmake install --user
```


## Tips for compilation on Compute Canada server

### Compilation on Intel based cluster with ICC compiler

CUBA configure step (2): 

```
./configure FC=`which ifort` CC=`which icc` CFLAGS="-O3 -fPIC"
```

QCM configure step (3) with CMake:

```
cmake .. -DCMAKE_BUILD_TYPE=Release -DCUBA_DIR=../CUBA-4.2.1 -DCMAKE_CXX_COMPILER=`which icc` -DBLA_VENDOR=Intel10_64lp_seq -DCMAKE_INCLUDE_PATH=${MKLLROOT}/lib/intel64_lin/
```

### Compilation with FlexiBLAS

QCM configure step (3) with CMake 3.21.4: 

```
module load cmake/3.21.4 flexiblas
cmake .. -DCMAKE_BUILD_TYPE=Release -DCUBA_DIR=../CUBA-4.2.1 -DBLA_VENDOR=FlexiBLAS
```


